/* Details of the maps used by the levels */
var maps = {
    "plains": {
        "mapImage": "plains.png",

        /* Terrain Data - Auto Generated By level/convert-levels.js */
        "mapGridWidth": 60,
        "mapGridHeight": 40,
        "mapObstructedTerrain": [[0, 0], [1, 0], [2, 0], [26, 0], [27, 0], [28, 0], [29, 0], [30, 0], [31, 0], [32, 0], [33, 0], [44, 0], [45, 0], [46, 0], [47, 0], [48, 0], [49, 0], [50, 0], [51, 0], [52, 0], [53, 0], [54, 0], [55, 0], [56, 0], [58, 0], [59, 0], [0, 1], [1, 1], [2, 1], [25, 1], [26, 1], [27, 1], [28, 1], [29, 1], [30, 1], [31, 1], [32, 1], [45, 1], [46, 1], [47, 1], [48, 1], [49, 1], [50, 1], [51, 1], [52, 1], [53, 1], [54, 1], [55, 1], [56, 1], [58, 1], [59, 1], [12, 2], [13, 2], [14, 2], [25, 2], [26, 2], [27, 2], [28, 2], [29, 2], [30, 2], [31, 2], [45, 2], [46, 2], [47, 2], [48, 2], [49, 2], [50, 2], [51, 2], [52, 2], [53, 2], [54, 2], [55, 2], [56, 2], [58, 2], [59, 2], [10, 3], [11, 3], [12, 3], [13, 3], [14, 3], [25, 3], [26, 3], [27, 3], [29, 3], [30, 3], [31, 3], [47, 3], [48, 3], [49, 3], [50, 3], [51, 3], [52, 3], [53, 3], [54, 3], [55, 3], [58, 3], [59, 3], [10, 4], [11, 4], [12, 4], [13, 4], [14, 4], [15, 4], [48, 4], [49, 4], [50, 4], [51, 4], [52, 4], [53, 4], [58, 4], [59, 4], [10, 5], [11, 5], [12, 5], [13, 5], [14, 5], [15, 5], [48, 5], [49, 5], [50, 5], [51, 5], [58, 5], [59, 5], [13, 6], [14, 6], [15, 6], [49, 6], [50, 6], [51, 6], [52, 6], [53, 6], [54, 6], [58, 6], [59, 6], [15, 7], [19, 7], [49, 7], [50, 7], [51, 7], [52, 7], [53, 7], [54, 7], [58, 7], [59, 7], [32, 8], [33, 8], [34, 8], [49, 8], [50, 8], [51, 8], [52, 8], [53, 8], [54, 8], [58, 8], [59, 8], [3, 9], [4, 9], [5, 9], [32, 9], [33, 9], [34, 9], [49, 9], [50, 9], [51, 9], [52, 9], [53, 9], [58, 9], [59, 9], [3, 10], [4, 10], [5, 10], [6, 10], [7, 10], [8, 10], [9, 10], [11, 10], [12, 10], [13, 10], [32, 10], [33, 10], [34, 10], [49, 10], [50, 10], [51, 10], [52, 10], [53, 10], [58, 10], [59, 10], [3, 11], [4, 11], [5, 11], [6, 11], [7, 11], [8, 11], [9, 11], [10, 11], [11, 11], [12, 11], [13, 11], [49, 11], [50, 11], [51, 11], [52, 11], [53, 11], [58, 11], [59, 11], [5, 12], [6, 12], [7, 12], [8, 12], [9, 12], [10, 12], [11, 12], [12, 12], [13, 12], [29, 12], [48, 12], [49, 12], [50, 12], [51, 12], [52, 12], [53, 12], [5, 13], [6, 13], [7, 13], [30, 13], [34, 13], [35, 13], [36, 13], [48, 13], [49, 13], [50, 13], [51, 13], [52, 13], [53, 13], [5, 14], [6, 14], [7, 14], [20, 14], [21, 14], [34, 14], [35, 14], [36, 14], [48, 14], [49, 14], [50, 14], [51, 14], [52, 14], [53, 14], [34, 15], [35, 15], [36, 15], [49, 15], [50, 15], [51, 15], [52, 15], [53, 15], [47, 16], [48, 16], [49, 16], [50, 16], [51, 16], [52, 16], [53, 16], [44, 17], [47, 17], [48, 17], [49, 17], [50, 17], [51, 17], [52, 17], [16, 18], [17, 18], [18, 18], [47, 18], [48, 18], [49, 18], [50, 18], [51, 18], [52, 18], [9, 19], [10, 19], [11, 19], [16, 19], [17, 19], [18, 19], [43, 19], [44, 19], [45, 19], [46, 19], [47, 19], [48, 19], [50, 19], [51, 19], [52, 19], [9, 20], [10, 20], [11, 20], [16, 20], [17, 20], [18, 20], [43, 20], [44, 20], [45, 20], [46, 20], [47, 20], [48, 20], [9, 21], [10, 21], [11, 21], [24, 21], [25, 21], [26, 21], [30, 21], [31, 21], [32, 21], [43, 21], [44, 21], [45, 21], [46, 21], [47, 21], [48, 21], [24, 22], [25, 22], [26, 22], [27, 22], [28, 22], [29, 22], [30, 22], [31, 22], [32, 22], [41, 22], [42, 22], [43, 22], [44, 22], [45, 22], [46, 22], [47, 22], [48, 22], [49, 22], [50, 22], [24, 23], [25, 23], [26, 23], [27, 23], [28, 23], [29, 23], [30, 23], [31, 23], [32, 23], [41, 23], [42, 23], [43, 23], [44, 23], [45, 23], [46, 23], [47, 23], [48, 23], [49, 23], [50, 23], [25, 24], [26, 24], [27, 24], [28, 24], [29, 24], [41, 24], [42, 24], [43, 24], [44, 24], [45, 24], [46, 24], [47, 24], [48, 24], [49, 24], [50, 24], [2, 25], [3, 25], [4, 25], [24, 25], [25, 25], [26, 25], [27, 25], [28, 25], [29, 25], [43, 25], [44, 25], [45, 25], [46, 25], [47, 25], [2, 26], [3, 26], [4, 26], [24, 26], [25, 26], [26, 26], [27, 26], [28, 26], [29, 26], [43, 26], [44, 26], [45, 26], [46, 26], [47, 26], [2, 27], [3, 27], [4, 27], [24, 27], [25, 27], [26, 27], [27, 27], [28, 27], [29, 27], [43, 27], [44, 27], [45, 27], [46, 27], [47, 27], [25, 28], [26, 28], [27, 28], [28, 28], [29, 28], [43, 28], [44, 28], [45, 28], [46, 28], [47, 28], [54, 28], [8, 29], [9, 29], [23, 29], [24, 29], [25, 29], [26, 29], [27, 29], [28, 29], [29, 29], [43, 29], [44, 29], [45, 29], [46, 29], [47, 29], [59, 29], [9, 30], [23, 30], [24, 30], [25, 30], [26, 30], [27, 30], [28, 30], [43, 30], [44, 30], [45, 30], [46, 30], [47, 30], [59, 30], [23, 31], [24, 31], [25, 31], [26, 31], [27, 31], [28, 31], [36, 31], [59, 31], [17, 32], [18, 32], [19, 32], [25, 32], [26, 32], [27, 32], [28, 32], [46, 32], [55, 32], [59, 32], [17, 33], [18, 33], [19, 33], [23, 33], [24, 33], [25, 33], [26, 33], [27, 33], [28, 33], [33, 33], [34, 33], [35, 33], [59, 33], [17, 34], [18, 34], [19, 34], [23, 34], [24, 34], [25, 34], [26, 34], [27, 34], [28, 34], [33, 34], [34, 34], [35, 34], [59, 34], [23, 35], [24, 35], [25, 35], [26, 35], [27, 35], [28, 35], [33, 35], [34, 35], [35, 35], [59, 35], [24, 36], [25, 36], [26, 36], [27, 36], [28, 36], [59, 36], [22, 37], [23, 37], [24, 37], [25, 37], [26, 37], [27, 37], [28, 37], [59, 37], [22, 38], [23, 38], [24, 38], [25, 38], [26, 38], [27, 38], [59, 38], [22, 39], [23, 39], [24, 39], [25, 39], [26, 39], [27, 39], [48, 39], [49, 39], [50, 39], [51, 39], [52, 39], [53, 39], [54, 39], [55, 39], [56, 39], [57, 39], [58, 39], [59, 39]],
    }
};

/* The actual levels played in the game */
var levels = {
    "singleplayer": [
        {
            "name": "Rescue",
            "briefing": "In the months since the great war, mankind has fallen into chaos. Billions are dead with cities in ruins.\nSmall groups of survivors band together to try and survive as best as they can.\nWe are trying to reach out to all the survivors in this sector before we join back with the main colony.",

            /* Map Details */
            "mapName": "plains",
            "startX": 36,
            "startY": 0,

            /* Entities to be loaded */
            "requirements": {
                "buildings": ["base"],
                "vehicles": ["transport", "scout-tank", "heavy-tank"],
                "aircraft": [],
                "terrain": []
            },

            /* Entities to be added */
            "items": [
                /* Slightly damaged base */
                { "type": "buildings", "name": "base", "x": 55, "y": 6, "team": "blue", "life": 100 },

                /* Our hero tank */
                { "type": "vehicles", "name": "heavy-tank", "uid": -1, "x": 57, "y": 12, "direction": 4, "team": "blue" },

                /* Two transport vehicles waiting just to be rescued just outside the visible map */
                { "type": "vehicles", "name": "transport", "uid": -3, "selectable": false, "x": -3, "y": 2, "direction": 2, "team": "blue" },
                { "type": "vehicles", "name": "transport", "uid": -4, "selectable": false, "x": -3, "y": 4, "direction": 2, "team": "blue" },

                /* Two damaged enemy scout-tanks patroling the area*/
                { "type": "vehicles", "name": "scout-tank", "uid": -2, "x": 40, "y": 20, "direction": 4, "team": "green", "life": 20, "orders": { "type": "patrol", "from": { "x": 34, "y": 20 }, "to": { "x": 42, "y": 25 } } },
                { "type": "vehicles", "name": "scout-tank", "uid": -5, "x": 14, "y": 0, "direction": 4, "team": "green", "life": 20, "orders": { "type": "patrol", "from": { "x": 14, "y": 0 }, "to": { "x": 14, "y": 14 } } },

            ],

            "cash": {
                "blue": 0,
                "green": 0
            },

            /* Conditional and Timed Trigger Events */
            "triggers": [
                {
                    "type": "timed", "time": 3000,
                    // Tell the player to search for the convoy
                    "action": function() {
                        game.showMessage("op", "Commander!! We haven't heard from the last convoy in over two hours. They should have arrived by now.");
                    }
                },
                {
                    "type": "timed", "time": 10000,
                    // Give player hint to help find the convoy
                    "action": function() {
                        game.showMessage("op", "They were last seen in the North West Sector. Could you investigate?");
                    }
                },
                {
                    "type": "conditional",
                    // Check if either the hero tank or the two convoy vehicles are dead
                    "condition": function() {
                        return (game.isItemDead(-1) || game.isItemDead(-3) || game.isItemDead(-4));
                    },
                    // End the mission as failure
                    "action": function() {
                        singleplayer.endLevel(false);
                    }
                },
                {
                    "type": "conditional",
                    // Check if first enemy is dead
                    "condition": function() {
                        return game.isItemDead(-2);
                    },
                    // Make a comment about the rebel aggression
                    "action": function() {
                        game.showMessage("op", "The rebels have been getting very aggressive lately. I hope the convoy is safe. Find them and escort them back to the base.");
                    }
                },
                {
                    "type": "conditional",
                    // Check if hero has reached the top left quadrant of the map
                    "condition": function() {
                        let hero = game.getItemByUid(-1);

                        return (hero && hero.x < 30 && hero.y < 30);
                    },
                    // Display distress call from the driver
                    "action": function() {
                        game.showMessage("driver", "Can anyone hear us? Our convoy has been pinned down by rebel tanks. We need help.");
                    }
                },
                {
                    "type": "conditional",
                    // Check if player is near convoy location
                    "condition": function() {
                        let hero = game.getItemByUid(-1);

                        return (hero && hero.x < 10 && hero.y < 10);
                    },
                    // Show thank you message from driver and tell convoy to follow hero
                    "action": function() {
                        var hero = game.getItemByUid(-1);

                        game.showMessage("driver", "Thank you. We thought we would never get out of here alive.");
                        game.sendCommand([-3, -4], { type: "guard", to: hero });
                    }
                },
                {
                    "type": "conditional",
                    // Check if convoy vehicles are near the base
                    "condition": function() {
                        var transport1 = game.getItemByUid(-3);
                        var transport2 = game.getItemByUid(-4);

                        return (transport1 && transport2 && transport1.x > 52 && transport2.x > 52 && transport2.y < 18 && transport1.y < 18);
                    },
                    // End the mission as success
                    "action": function() {
                        singleplayer.endLevel(true);
                    }
                },
            ],
        },

        {
            "name": "Assault",
            "briefing": "Thanks to the supplies from the convoy, we now have the base up and running.\n The rebels nearby are proving to be a problem. We need to take them out. \n First set up the base defences. Then find and destroy all rebels in the area.\n The colony will be sending us reinforcements to help us out.",

            /* Map Details */
            "mapName": "plains",
            "startX": 36,
            "startY": 0,


            /* Entities to be loaded */
            "requirements": {
                "buildings": ["base", "ground-turret", "starport", "harvester"],
                "vehicles": ["transport", "scout-tank", "heavy-tank"],
                "aircraft": ["chopper"],
                "terrain": []
            },

            /* Economy Related*/
            "cash": {
                "blue": 0,
                "green": 0
            },

            /* Entities to be added */
            "items": [
                { "type": "buildings", "name": "base", "uid": -1, "x": 55, "y": 6, "team": "blue" },

                { "type": "buildings", "name": "ground-turret", "x": 53, "y": 17, "team": "blue" },
                { "type": "vehicles", "name": "heavy-tank", "uid": -2, "x": 55, "y": 16, "direction": 4, "team": "blue", "orders": { "type": "sentry" } },

                /* The first wave of attacks*/
                { "type": "vehicles", "name": "scout-tank", "x": 55, "y": 36, "direction": 4, "team": "green", "orders": { "type": "hunt" } },
                { "type": "vehicles", "name": "scout-tank", "x": 53, "y": 36, "direction": 4, "team": "green", "orders": { "type": "hunt" } },

                /* Enemies patroling the area */
                { "type": "vehicles", "name": "scout-tank", "x": 5, "y": 5, "direction": 4, "team": "green", "orders": { "type": "patrol", "from": { "x": 5, "y": 5 }, "to": { "x": 20, "y": 20 } } },
                { "type": "vehicles", "name": "scout-tank", "x": 5, "y": 15, "direction": 4, "team": "green", "orders": { "type": "patrol", "from": { "x": 5, "y": 15 }, "to": { "x": 20, "y": 30 } } },
                { "type": "vehicles", "name": "scout-tank", "x": 25, "y": 5, "direction": 4, "team": "green", "orders": { "type": "patrol", "from": { "x": 25, "y": 5 }, "to": { "x": 25, "y": 20 } } },
                { "type": "vehicles", "name": "scout-tank", "x": 35, "y": 5, "direction": 4, "team": "green", "orders": { "type": "patrol", "from": { "x": 35, "y": 5 }, "to": { "x": 35, "y": 30 } } },

                /* The Evil Rebel Base*/
                { "type": "buildings", "name": "base", "uid": -11, "x": 5, "y": 36, "team": "green" },
                { "type": "buildings", "name": "starport", "uid": -12, "x": 1, "y": 30, "team": "green" },
                { "type": "buildings", "name": "starport", "uid": -13, "x": 4, "y": 32, "team": "green" },

                { "type": "buildings", "name": "harvester", "x": 1, "y": 38, "team": "green", "action": "deploy" },
                { "type": "buildings", "name": "ground-turret", "x": 5, "y": 28, "team": "green" },
                { "type": "buildings", "name": "ground-turret", "x": 7, "y": 33, "team": "green" },
                { "type": "buildings", "name": "ground-turret", "x": 8, "y": 37, "team": "green" },
            ],

            /* Conditional and Timed Trigger Events */
            "triggers": [
                {
                    "type": "timed", "time": 8000,
                    // Send in reinforcements to guard the hero tank from the first enemy wave
                    "action": function() {
                        game.showMessage("op", "Commander!! Reinforcements have arrived from the colony.");
                        let hero = game.getItemByUid(-2);

                        game.add({
                            "type": "vehicles",
                            "name": "scout-tank",
                            "team": "blue",
                            "x": 61, "y": 22,
                            "orders": { "type": "guard", "to": hero }
                        });
                        game.add({
                            "type": "vehicles",
                            "name": "scout-tank",
                            "team": "blue",
                            "x": 61, "y": 21,
                            "orders": { "type": "guard", "to": hero }
                        });
                    }
                },
                {
                    "type": "timed", "time": 25000,
                    // Supply extra cash
                    "action": function() {
                        game.cash["blue"] = 1500;
                        game.showMessage("op", "Commander!! We have enough resources for another ground turret. Set up the turret to keep the base safe from any more attacks.");
                    }
                },
                {
                    "type": "timed", "time": 60000, "repeat": true,
                    // Construct a couple of bad guys to hunt the player every time enemy has enough money
                    "action": function() {
                        if (game.cash["green"] > 1000) {
                            game.sendCommand([-12, -13], {
                                type: "construct-unit",
                                details: { type: "vehicles", name: "scout-tank", orders: { "type": "hunt" } }
                            });
                        }
                    }
                },
                {
                    "type": "timed", "time": 180000, "repeat": true,
                    // Send in more reinforcements every three minutes
                    "action": function() {
                        game.showMessage("op", "Commander!! More reinforcments have arrived.");
                        game.add({
                            "type": "vehicles",
                            "name": "scout-tank",
                            "team": "blue",
                            "x": 61, "y": 22,
                            "orders": { "type": "move", "to": { "x": 55, "y": 21 } }
                        });
                        game.add({
                            "type": "vehicles",
                            "name": "heavy-tank",
                            "team": "blue",
                            "x": 61, "y": 23,
                            "orders": { "type": "move", "to": { "x": 56, "y": 23 } }
                        });
                    }
                },
                {
                    "type": "timed", "time": 600000,
                    // Send in air support if the mission hasn't finished after 10 minutes
                    "action": function() {
                        game.showMessage("pilot", "Close Air Support en route. Will try to do whatever I can to help.");
                        game.add({
                            "type": "aircraft",
                            "name": "chopper",
                            "team": "blue",
                            "selectable": false,
                            "x": 61, "y": 22,
                            "orders": { "type": "hunt" }
                        });
                    }
                },
                {
                    "type": "conditional",
                    // Check if the player's base has been destroyed
                    "condition": function() {
                        return game.isItemDead(-1);
                    },
                    // End level as failure
                    "action": function() {
                        singleplayer.endLevel(false);
                    }
                },

                {
                    "type": "conditional",
                    // Check if the enemy base is at least half destroyed
                    "condition": function() {
                        let enemyBase = game.getItemByUid(-11);

                        return (!enemyBase || (enemyBase.life <= enemyBase.hitPoints / 2));
                    },
                    // End level as success
                    "action": function() {
                        singleplayer.endLevel(true);
                    }
                },
            ]
        },

        {
            "name": "Under Siege",
            "briefing": "Thanks to the attack led by you, we now have control of the rebel base. We can expect the rebels to try to retaliate.\n The colony is sending in aircraft to help us evacuate back to the main camp. All we need to do is hang tight until the choppers get here. \n Luckily, we have some supplies and ammunition to defend ourselves with until they get here. \n Protect the transports at all costs.",

            /* Map Details */
            "mapName": "plains",
            "startX": 0,
            "startY": 20,

            /* Entities to be loaded */
            "requirements": {
                "buildings": ["base", "ground-turret", "starport", "harvester"],
                "vehicles": ["transport", "scout-tank", "heavy-tank"],
                "aircraft": ["chopper", "wraith"],
                "terrain": []
            },

            /* Economy Related*/
            "cash": {
                "blue": 500,
                "green": 0
            },

            /* Entities to be added */
            "items": [
                /* The Rebel Base, which is now in our hands */
                { "type": "buildings", "name": "base", "uid": -11, "x": 5, "y": 36, "team": "blue" },
                { "type": "buildings", "name": "starport", "uid": -12, "x": 1, "y": 28, "team": "blue" },
                { "type": "buildings", "name": "starport", "uid": -13, "x": 4, "y": 32, "team": "blue" },
                { "type": "buildings", "name": "harvester", "x": 1, "y": 38, "team": "blue", "action": "deploy" },
                { "type": "buildings", "name": "ground-turret", "x": 7, "y": 28, "team": "blue" },
                { "type": "buildings", "name": "ground-turret", "x": 8, "y": 32, "team": "blue" },
                { "type": "buildings", "name": "ground-turret", "x": 11, "y": 37, "team": "blue" },

                /* The transports that need to be protected*/
                { "type": "vehicles", "name": "transport", "uid": -1, "x": 2, "y": 33, "team": "blue", "direction": 2, "selectable": false },
                { "type": "vehicles", "name": "transport", "uid": -2, "x": 1, "y": 34, "team": "blue", "direction": 2, "selectable": false },
                { "type": "vehicles", "name": "transport", "uid": -3, "x": 2, "y": 35, "team": "blue", "direction": 2, "selectable": false },
                { "type": "vehicles", "name": "transport", "uid": -4, "x": 1, "y": 36, "team": "blue", "direction": 2, "selectable": false },

                /* The chopper pilot from the last mission */
                {
                    "type": "aircraft",
                    "name": "chopper",
                    "x": 15, "y": 40,
                    "team": "blue",
                    "selectable": false,
                    "uid": -5,
                    "orders": { "type": "patrol", "from": { "x": 15, "y": 40 }, "to": { "x": 0, "y": 25 } }
                },

                /* The first wave of attacks*/
                { "type": "vehicles", "name": "scout-tank", "x": 15, "y": 16, "direction": 4, "team": "green", "orders": { "type": "hunt" } },
                { "type": "vehicles", "name": "scout-tank", "x": 17, "y": 16, "direction": 4, "team": "green", "orders": { "type": "hunt" } },

                /* Secret Rebel bases*/
                { "type": "buildings", "name": "starport", "uid": -23, "x": 35, "y": 37, "team": "green" },
                { "type": "buildings", "name": "starport", "uid": -24, "x": 33, "y": 37, "team": "green" },
                { "type": "buildings", "name": "harvester", "x": 28, "y": 39, "team": "green", "action": "deploy" },
                { "type": "buildings", "name": "harvester", "x": 30, "y": 39, "team": "green", "action": "deploy" },

                { "type": "buildings", "name": "starport", "uid": -21, "x": 3, "y": 0, "team": "green" },
                { "type": "buildings", "name": "starport", "uid": -22, "x": 6, "y": 0, "team": "green" },
                { "type": "buildings", "name": "harvester", "x": 0, "y": 2, "team": "green", "action": "deploy" },
                { "type": "buildings", "name": "harvester", "x": 0, "y": 4, "team": "green", "action": "deploy" },

            ],

            /* Conditional and Timed Trigger Events */
            "triggers": [
                {
                    // Check if any of the transports is dead
                    "condition": function() {
                        return game.isItemDead(-1) || game.isItemDead(-2) || game.isItemDead(-3) || game.isItemDead(-4);
                    },
                    // End the level as failure
                    "action": function() {
                        singleplayer.endLevel(false);
                    }
                },
                {
                    "type": "timed", "time": 5000,
                    // Display warning message about attacks
                    "action": function() {
                        game.showMessage("op", "Commander!! The rebels have started attacking. We need to defend the base and protect the transports at all costs.");
                    }
                },
                {
                    "type": "timed", "time": 20000,
                    // Add a new transport to the top right of the map
                    "action": function() {
                        game.add({ "type": "vehicles", "name": "transport", "x": 57, "y": 3, "team": "blue", "direction": 4, "selectable": false, "uid": -6 });
                        game.showMessage("driver", "Commander!! The colony has sent some extra supplies. We are coming in from the North East sector through rebel territory. We could use a little protection.");
                    }
                },
                {
                    "type": "timed", "time": 24000,
                    // Make the pilot guard the new transport
                    "action": function() {
                        game.sendCommand([-5], { "type": "guard", "toUid": -6 });
                        game.showMessage("pilot", "Hang tight. I'm on my way.");
                    }
                },

                {
                    "type": "timed", "time": 28000,
                    // Add some villains to make it interesting
                    "action": function() {
                        game.add({ "type": "vehicles", "name": "scout-tank", "x": 57, "y": 28, "team": "green", "orders": { "type": "hunt" } });
                        game.add({ "type": "aircraft", "name": "wraith", "x": 55, "y": 33, "team": "green", "orders": { "type": "sentry" } });
                        game.add({ "type": "aircraft", "name": "wraith", "x": 53, "y": 33, "team": "green", "orders": { "type": "sentry" } });
                        game.add({ "type": "vehicles", "name": "scout-tank", "x": 35, "y": 25, "life": 20, "direction": 4, "team": "green", "orders": { "type": "patrol", "from": { "x": 35, "y": 25 }, "to": { "x": 35, "y": 30 } } });
                    }
                },
                {
                    "type": "timed", "time": 48000,
                    // Start moving the transport towards the base
                    "action": function() {
                        game.showMessage("driver", "Thanks! Appreciate the backup. All right. Off we go.");
                        game.sendCommand([-6], { "type": "move", "to": { "x": 0, "y": 32 } });
                    }
                },
                {
                    "type": "conditional",
                    // Check if pilot has been hurt
                    "condition": function() {
                        let pilot = game.getItemByUid(-5);

                        return pilot.life < pilot.hitPoints;
                    },
                    // Have pilot ask for help
                    "action": function() {
                        game.showMessage("pilot", "We are under attack! Need assistance. This doesn't look good.");
                    }
                },
                { "type": "conditional",
                    // Check if new transport has reached base with supplies
                    "condition": function() {
                        let driver = game.getItemByUid(-6);

                        return driver && driver.x < 2 && driver.y > 30;
                    },
                    // Give player extra cash "supplies"
                    "action": function() {
                        game.showMessage("driver", "The rebels came out of nowhere. There was nothing we could do. She saved our lives. Hope these supplies were worth it.");
                        game.cash["blue"] += 1200;
                    }
                },
                {
                    "type": "timed", "time": 150000, "repeat": true,
                    // Send in waves of enemies every 150 seconds
                    "action": function() {
                        // Count aircraft and tanks already available to bad guys
                        let wraithCount = 0;
                        let chopperCount = 0;
                        let scoutTankCount = 0;
                        let heavyTankCount = 0;

                        game.items.forEach(function(item) {
                            if (item.team === "green") {
                                switch (item.name) {
                                    case "chopper":
                                        chopperCount++;
                                        break;
                                    case "wraith":
                                        wraithCount++;
                                        break;
                                    case "scout-tank":
                                        scoutTankCount++;
                                        break;
                                    case "heavy-tank":
                                        heavyTankCount++;
                                        break;
                                }
                            }
                        }, this);

                        // Make sure enemy has atleast two wraiths and two heavy tanks, and use the remaining starports to build choppers and scouts
                        if (wraithCount === 0) {
                            // No wraiths alive. Ask both starports to make wraiths
                            game.sendCommand([-23, -24], { type: "construct-unit", details: { type: "aircraft", name: "wraith", "orders": { "type": "hunt" } } });
                        } else if (wraithCount === 1) {
                            // One wraith alive. Ask starports to make one wraith and one chopper
                            game.sendCommand([-23], { type: "construct-unit", details: { type: "aircraft", name: "wraith", "orders": { "type": "hunt" } } });
                            game.sendCommand([-24], { type: "construct-unit", details: { type: "aircraft", name: "chopper", "orders": { "type": "hunt" } } });
                        } else {
                            // Two wraiths alive. Ask both starports to make choppers
                            game.sendCommand([-23, -24], { type: "construct-unit", details: { type: "aircraft", name: "chopper", "orders": { "type": "hunt" } } });
                        }

                        if (heavyTankCount === 0) {
                            // No heavy-tanks alive. Ask both starports to make heavy-tanks
                            game.sendCommand([-21, -22], { type: "construct-unit", details: { type: "vehicles", name: "heavy-tank", "orders": { "type": "hunt" } } });
                        } else if (heavyTankCount === 1) {
                        // One heavy-tank alive. Ask starports to make one heavy-tank and one scout-tank
                            game.sendCommand([-21], { type: "construct-unit", details: { type: "vehicles", name: "heavy-tank", "orders": { "type": "hunt" } } });
                            game.sendCommand([-22], { type: "construct-unit", details: { type: "vehicles", name: "scout-tank", "orders": { "type": "hunt" } } });
                        } else {
                            // Two heavy-tanks alive. Ask both starports to make scout-tanks
                            game.sendCommand([-21, -22], { type: "construct-unit", details: { type: "vehicles", name: "scout-tank", "orders": { "type": "hunt" } } });
                        }
                        // Ask any enemy units on the field to attack
                        let uids = [];

                        game.items.forEach(function(item) {
                            if (item.team === "green" && item.canAttack) {
                                uids.push(item.uid);
                            }
                        }, this);

                        game.sendCommand(uids, { "type": "hunt" });
                    }
                },
                {
                    "type": "timed", "time": 480000,
                    // After 8 minutes, start preparing for the end
                    "action": function() {
                        game.showMessage("op", "Commander!! The colony air fleet is just a few minutes away.");
                    }
                },
                {
                    "type": "timed", "time": 600000,
                    //After 10 minutes send in reinforcements
                    "action": function() {
                        game.showMessage("op", "Commander!! The colony air fleet is approaching");
                        game.add({ "type": "aircraft", "name": "wraith", "x": -1, "y": 28, "team": "blue", "orders": { "type": "hunt" } });
                        game.add({ "type": "aircraft", "name": "chopper", "x": -1, "y": 29, "team": "blue", "orders": { "type": "hunt" } });
                        game.add({ "type": "aircraft", "name": "wraith", "x": -1, "y": 30, "team": "blue", "orders": { "type": "hunt" } });
                        game.add({ "type": "aircraft", "name": "chopper", "x": -1, "y": 31, "team": "blue", "orders": { "type": "hunt" } });
                        game.add({ "type": "aircraft", "name": "wraith", "x": -1, "y": 32, "team": "blue", "orders": { "type": "hunt" } });
                        game.add({ "type": "aircraft", "name": "chopper", "x": -1, "y": 33, "team": "blue", "orders": { "type": "hunt" } });
                        game.add({ "type": "aircraft", "name": "wraith", "x": -1, "y": 34, "team": "blue", "orders": { "type": "hunt" } });
                        game.add({ "type": "aircraft", "name": "chopper", "x": -1, "y": 35, "team": "blue", "orders": { "type": "hunt" } });
                        game.add({ "type": "aircraft", "name": "wraith", "x": -1, "y": 36, "team": "blue", "orders": { "type": "hunt" } });
                        game.add({ "type": "aircraft", "name": "chopper", "x": -1, "y": 37, "team": "blue", "orders": { "type": "hunt" } });
                        game.add({ "type": "aircraft", "name": "wraith", "x": -1, "y": 38, "team": "blue", "orders": { "type": "hunt" } });
                        game.add({ "type": "aircraft", "name": "chopper", "x": -1, "y": 39, "team": "blue", "orders": { "type": "hunt" } });
                    }
                },
                {
                    "type": "timed", "time": 660000,
                    // And a minute after the reinforcements arrive, end the level
                    "action": function() {
                        singleplayer.endLevel(true);
                    }
                },
            ],
        }
    ],

    "multiplayer": [
        {
            /* Map Details */
            "mapName": "plains",

            /* Entities to be loaded */
            "requirements": {
                "buildings": ["base", "harvester", "starport", "ground-turret"],
                "vehicles": ["transport", "scout-tank", "heavy-tank", "harvester"],
                "aircraft": ["wraith", "chopper"],
                "terrain": ["oilfield"]
            },

            /* Starting Cash */
            "cash": {
                "blue": 3000,
                "green": 3000
            },

            /* Entities to be added */
            "items": [
                { "type": "terrain", "name": "oilfield", "x": 16, "y": 4, "action": "hint" },
                { "type": "terrain", "name": "oilfield", "x": 34, "y": 12, "action": "hint" },
                { "type": "terrain", "name": "oilfield", "x": 1, "y": 30, "action": "hint" },
                { "type": "terrain", "name": "oilfield", "x": 38, "y": 38, "action": "hint" },
            ],

            /* Entities for each starting team */
            "teamStartingItems": [
                { "type": "buildings", "name": "base", "x": 0, "y": 0 },
                { "type": "vehicles", "name": "harvester", "x": 4, "y": 0 },
                { "type": "vehicles", "name": "heavy-tank", "x": 4, "y": 2 },
                { "type": "vehicles", "name": "scout-tank", "x": 6, "y": 0 },
                { "type": "vehicles", "name": "scout-tank", "x": 6, "y": 2 },
            ],

            /* Possible starting spawn locations for the players */
            "spawnLocations": [
                { "x": 48, "y": 36, "startX": 36, "startY": 20 },
                { "x": 3, "y": 36, "startX": 0, "startY": 20 },
                { "x": 36, "y": 3, "startX": 32, "startY": 0 },
                { "x": 3, "y": 3, "startX": 0, "startY": 0 },
            ],

            /* Conditional and Timed Trigger Events */
            "triggers": [
            ]

        }

    ]
};


